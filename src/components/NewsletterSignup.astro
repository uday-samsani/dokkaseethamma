---
// NewsletterSignup.astro - Reusable newsletter signup component
export interface Props {
  variant?: 'inline' | 'compact' | 'full';
  title?: string;
  description?: string;
  showNameField?: boolean;
}

const { 
  variant = 'full',
  title = 'Subscribe to Our Newsletter',
  description = 'Stay updated with our latest events, impact stories, and opportunities to help.',
  showNameField = true
} = Astro.props;

const isCompact = variant === 'compact';
const isInline = variant === 'inline';
---

<div class={`newsletter-signup ${isCompact ? 'max-w-sm' : 'max-w-xl mx-auto'}`}>
  {!isCompact && !isInline && (
    <div class="text-center mb-6">
      <h3 class="text-xl sm:text-2xl font-bold text-earth-900 dark:text-gray-100 mb-2">{title}</h3>
      <p class="text-earth-600 dark:text-gray-400 text-sm sm:text-base">{description}</p>
    </div>
  )}

  {isInline && (
    <div class="mb-3">
      <h4 class="text-base font-semibold text-white mb-1">{title}</h4>
      <p class="text-cream-200 text-sm">{description}</p>
    </div>
  )}

  <form 
    class={`newsletter-form ${isInline ? 'flex flex-col sm:flex-row gap-3' : 'space-y-4'}`}
    action="/api/newsletter/subscribe"
    method="POST"
    data-newsletter-form
  >
    {/* Success Message - Hidden by default */}
    <div class="newsletter-success hidden" data-success-message>
      <div class={`${isInline ? 'bg-green-500/20 border border-green-500/30' : 'bg-green-100 dark:bg-green-900/30 border border-green-300 dark:border-green-600'} rounded-lg p-4 flex items-start gap-3`}>
        <svg xmlns="http://www.w3.org/2000/svg" class={`w-5 h-5 mt-0.5 ${isInline ? 'text-green-300' : 'text-green-600 dark:text-green-400'}`} viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        </svg>
        <div>
          <p class={`font-medium ${isInline ? 'text-green-100' : 'text-green-800 dark:text-green-200'}`}>Successfully subscribed!</p>
          <p class={`text-sm ${isInline ? 'text-green-200' : 'text-green-600 dark:text-green-300'}`}>Thank you for joining our community.</p>
        </div>
      </div>
    </div>

    {/* Form Fields */}
    <div class={`form-fields ${isInline ? 'flex-1 flex flex-col sm:flex-row gap-3' : 'space-y-4'}`} data-form-fields>
      {showNameField && !isCompact && (
        <div class={isInline ? 'sm:w-1/3' : ''}>
          <label 
            for={`newsletter-name-${variant}`} 
            class={`block text-sm font-medium mb-1.5 ${isInline ? 'text-cream-100' : 'text-earth-700 dark:text-gray-300'}`}
          >
            Name <span class="text-earth-400">(optional)</span>
          </label>
          <input
            type="text"
            id={`newsletter-name-${variant}`}
            name="name"
            placeholder="Your name"
            class={`w-full px-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-golden-400 focus:border-golden-400 outline-none transition-colors ${
              isInline 
                ? 'bg-white/10 border-white/20 text-white placeholder:text-cream-300/60' 
                : 'bg-white dark:bg-gray-700 border-cream-300 dark:border-gray-600 text-earth-900 dark:text-gray-100 placeholder:text-earth-400 dark:placeholder:text-gray-500'
            }`}
          />
        </div>
      )}
      
      <div class={isInline ? 'flex-1' : showNameField ? '' : ''}>
        {!isInline && !isCompact && (
          <label 
            for={`newsletter-email-${variant}`} 
            class="block text-sm font-medium text-earth-700 dark:text-gray-300 mb-1.5"
          >
            Email Address <span class="text-red-500">*</span>
          </label>
        )}
        <input
          type="email"
          id={`newsletter-email-${variant}`}
          name="email"
          required
          placeholder={isCompact ? "Enter your email" : "your@email.com"}
          class={`w-full px-4 py-2.5 rounded-lg border focus:ring-2 focus:ring-golden-400 focus:border-golden-400 outline-none transition-colors ${
            isInline 
              ? 'bg-white/10 border-white/20 text-white placeholder:text-cream-300/60' 
              : 'bg-white dark:bg-gray-700 border-cream-300 dark:border-gray-600 text-earth-900 dark:text-gray-100 placeholder:text-earth-400 dark:placeholder:text-gray-500'
          }`}
        />
      </div>

      <button
        type="submit"
        class={`newsletter-submit font-medium transition-all duration-200 flex items-center justify-center gap-2 ${
          isInline
            ? 'sm:w-auto w-full px-6 py-2.5 bg-white text-golden-600 hover:bg-cream-100 rounded-lg'
            : isCompact
              ? 'w-full px-4 py-2 bg-gradient-to-r from-golden-500 to-golden-600 hover:from-golden-600 hover:to-golden-700 text-white rounded-full'
              : 'w-full sm:w-auto px-8 py-3 bg-gradient-to-r from-golden-500 to-golden-600 hover:from-golden-600 hover:to-golden-700 text-white rounded-full'
        }`}
      >
        <span class="btn-text">Subscribe</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="btn-icon w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="22" y1="2" x2="11" y2="13"/>
          <polygon points="22 2 15 22 11 13 2 9 22 2"/>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" class="btn-loader hidden w-4 h-4 animate-spin" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
        </svg>
      </button>
    </div>

    {!isCompact && !isInline && (
      <p class="text-xs text-earth-500 dark:text-gray-500 text-center mt-4">
        We respect your privacy. Unsubscribe at any time.
      </p>
    )}
  </form>
</div>

<script>
  // Newsletter form handling
  document.querySelectorAll('[data-newsletter-form]').forEach(form => {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = form.querySelector('.newsletter-submit') as HTMLButtonElement;
      const btnText = submitBtn?.querySelector('.btn-text');
      const btnIcon = submitBtn?.querySelector('.btn-icon');
      const btnLoader = submitBtn?.querySelector('.btn-loader');
      const formFields = form.querySelector('[data-form-fields]');
      const successMessage = form.querySelector('[data-success-message]');
      
      // Show loading state
      submitBtn?.classList.add('opacity-75', 'cursor-not-allowed');
      btnText?.classList.add('hidden');
      btnIcon?.classList.add('hidden');
      btnLoader?.classList.remove('hidden');
      
      // Simulate API call (replace with actual endpoint)
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Show success message
      formFields?.classList.add('hidden');
      successMessage?.classList.remove('hidden');
      
      // Reset button state
      submitBtn?.classList.remove('opacity-75', 'cursor-not-allowed');
      btnText?.classList.remove('hidden');
      btnIcon?.classList.remove('hidden');
      btnLoader?.classList.add('hidden');
      
      // Reset form after 5 seconds
      setTimeout(() => {
        form.reset();
        formFields?.classList.remove('hidden');
        successMessage?.classList.add('hidden');
      }, 5000);
    });
  });
</script>